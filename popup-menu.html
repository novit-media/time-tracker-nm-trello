<!DOCTYPE html>
<html lang="pl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time Tracker NM - Menu</title><script src="https://p.trellocdn.com/power-up.min.js"></script>
<style>body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;margin:0;padding:12px;background:#f4f5f7;}
button{display:block;width:100%;margin:6px 0;padding:8px 12px;border:none;border-radius:3px;background:#0052CC;color:#fff;cursor:pointer;font-size:14px;}
button:hover{background:#0747A6;}</style></head><body>
<button id="openModal">Otw√≥rz Time Tracker</button>
<button id="startBtn">Start</button>
<button id="stopBtn">Stop</button>
<script>
var t=TrelloPowerUp.iframe();var args=t.arg()||{};
document.getElementById('openModal').onclick=function(){t.modal({title:'Time Tracker NM',url:'popup.html',accentColor:'#667eea',fullscreen:true,args:{cardId:args.cardId}});};
document.getElementById('startBtn').onclick=function(){
 t.get('card','shared','timeData',{plannedMinutes:0,spentMinutes:0,history:[]}).then(function(d){
  d.timerRunning=true;d.timerStart=Date.now();d.history=d.history||[];d.history.push({type:'start',minutes:0,ts:new Date().toISOString(),note:''});
  return t.set('card','shared','timeData',d);
 }).then(function(){t.refresh();t.closePopup();});
};
document.getElementById('stopBtn').onclick=function(){
 t.get('card','shared','timeData',{plannedMinutes:0,spentMinutes:0,timerRunning:false,timerStart:0,history:[]}).then(function(d){
  var now=Date.now();var diffMin=Math.ceil((now-(d.timerStart||now))/60000);
  d.spentMinutes=(d.spentMinutes||0)+diffMin;d.timerRunning=false;d.timerStart=0;d.history=d.history||[];
  var note=prompt('Komentarz do wpisu (opcjonalnie):','')||'';
  d.history.push({type:'stop',minutes:diffMin,ts:new Date().toISOString(),note:note});
  return t.set('card','shared','timeData',d).then(function(){if(typeof t.comment==='function'){return t.comment('Automatycznie dodano '+diffMin+' minut po zatrzymaniu timera.').catch(function(){});}});
 }).then(function(){t.refresh();t.closePopup();});
};
t.render(function(){return t.sizeTo(document.body);});</script></body></html>
