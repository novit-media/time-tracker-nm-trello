<!DOCTYPE html><html lang="pl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Time Tracker NM - UI</title><script src="https://p.trellocdn.com/power-up.min.js"></script><link rel="stylesheet" href="styles.css"></head><body>
<div class="container"><h1>‚è±Ô∏è Time Tracker NM</h1>
<div class="section"><h2>üìã Planowanie czasu</h2><div class="input-group"><label>Godziny:</label><input type="number" id="plannedHours" min="0" max="999" value="0"><label>Minuty:</label><input type="number" id="plannedMinutes" min="0" max="59" value="0"><button id="btnPlanned">Zapisz</button></div></div>
<div class="section"><h2>‚è∞ Ju≈º przepracowany czas</h2><div class="input-group"><label>Godziny:</label><input type="number" id="spentHours" min="0" max="999" value="0"><label>Minuty:</label><input type="number" id="spentMinutes" min="0" max="59" value="0"><button id="btnSpent">Zapisz</button></div></div>
<div class="section progress-section"><h2>üìä Postƒôp zadania</h2><div class="time-info"><span>Planowane: <span id="displayPlanned">0:00</span></span><span>Przepracowane: <span id="displaySpent">0:00</span></span><span>Pozosta≈Ço: <span id="displayRemaining">0:00</span></span></div>
<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div></div>
<div class="section timer-section"><h2>‚è±Ô∏è Timer na ≈ºywo</h2><div class="timer-display" id="timerDisplay">00:00:00</div><div class="status stopped" id="timerStatus">Timer zatrzymany</div>
<div class="timer-buttons"><button class="btn-start" id="btnStart">Start</button><button class="btn-stop" id="btnStop">Stop</button><button class="btn-reset" id="btnReset">Reset</button><button class="btn-save" id="btnSave">Dodaj</button></div></div>
<div class="section" id="historySection"><h2>üóÇ Historia wpis√≥w</h2><ul id="historyList" class="history-list"></ul></div></div>
<script>
var t=TrelloPowerUp.iframe();var args=t.arg()||{};var timerInterval=null,currentTimerSeconds=0,isTimerRunning=false;
function askForNote(t,defVal){return t.popup({title:'Komentarz',url:'note.html',height:200,args:{defaultText:defVal||''}}).then(function(){return t.get('board','private','_tmp_note',null).then(function(v){return t.set('board','private','_tmp_note',null).then(function(){return v;});});});}
function askConfirm(t,msg){return t.popup({title:'Potwierdzenie',url:'confirm.html',height:150,args:{message:msg||'Potwierd≈∫'}}).then(function(){return t.get('board','private','_tmp_confirm',false).then(function(v){return t.set('board','private','_tmp_confirm',false).then(function(){return v;});});});}
setInterval(function(){if(isTimerRunning){t.set('card','shared','_hb',Date.now()).catch(function(){});}},5000);
function loadTimeData(){return t.get('card','shared','timeData',{plannedMinutes:0,spentMinutes:0,timerRunning:false,timerStart:0,history:[]});}
function saveTimeData(d){return t.set('card','shared','timeData',d);}
function pushHistoryEntry(type,min,note){loadTimeData().then(function(d){d.history=d.history||[];d.history.push({type:type,minutes:min,ts:new Date().toISOString(),note:note||''});saveTimeData(d).then(function(){renderHistory(d.history);});});}
function renderHistory(list){var ul=document.getElementById('historyList');if(!ul)return;ul.innerHTML='';(list||[]).slice().reverse().forEach(function(item,revIdx){var originalIdx=(list.length-1)-revIdx;var li=document.createElement('li');li.setAttribute('data-idx',originalIdx);var base='['+new Date(item.ts).toLocaleString()+'] '+item.type+': '+(item.minutes||0)+' min';if(item.note&&item.note.trim()){base+=' ‚Äì '+item.note.trim();}var textSpan=document.createElement('span');textSpan.textContent=base;li.appendChild(textSpan);var btnEdit=document.createElement('button');btnEdit.className='hist-btn-edit';btnEdit.textContent='Edytuj';btnEdit.onclick=function(){editHistory(originalIdx);};var btnDel=document.createElement('button');btnDel.className='hist-btn-del';btnDel.textContent='Usu≈Ñ';btnDel.onclick=function(){deleteHistory(originalIdx);};li.appendChild(btnEdit);li.appendChild(btnDel);ul.appendChild(li);});}
function editHistory(idx){loadTimeData().then(function(d){if(!d.history||typeof d.history[idx]==='undefined')return;var item=d.history[idx];var newMinutesStr=prompt('Nowa liczba minut (pozostaw puste aby nie zmieniaƒá):',item.minutes);var newMinutes=parseInt(newMinutesStr,10);if(isNaN(newMinutes))newMinutes=item.minutes;askForNote(t,item.note||'').then(function(newNote){d.history[idx].minutes=newMinutes;d.history[idx].note=newNote||item.note;saveTimeData(d).then(function(){renderHistory(d.history);});});});}
function deleteHistory(idx){askConfirm(t,'Na pewno usunƒÖƒá ten wpis?').then(function(ok){if(!ok)return;loadTimeData().then(function(d){if(!d.history||typeof d.history[idx]==='undefined')return;d.history.splice(idx,1);saveTimeData(d).then(function(){renderHistory(d.history);});});});}
function formatTime(m){var h=Math.floor(m/60),mi=m%60;return h>0?h+':'+mi.toString().padStart(2,'0'):''+mi;}
function formatTimerTime(s){var h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;return[h,m,sec].map(n=>n.toString().padStart(2,'0')).join(':');}
function updateDisplay(){loadTimeData().then(function(d){var planned=d.plannedMinutes,spent=d.spentMinutes,remaining=Math.max(0,planned-spent);document.getElementById('displayPlanned').textContent=formatTime(planned);document.getElementById('displaySpent').textContent=formatTime(spent);document.getElementById('displayRemaining').textContent=formatTime(remaining);var progress=planned>0?Math.min(100,(spent/planned)*100):0;document.getElementById('progressFill').style.width=progress+'%';document.getElementById('plannedHours').value=Math.floor(planned/60);document.getElementById('plannedMinutes').value=planned%60;document.getElementById('spentHours').value=Math.floor(spent/60);document.getElementById('spentMinutes').value=spent%60;renderHistory(d.history||[]);if(d.timerRunning&&d.timerStart){var diffSec=Math.floor((Date.now()-d.timerStart)/1000);currentTimerSeconds=diffSec;isTimerRunning=true;document.getElementById('timerStatus').textContent='Timer uruchomiony';document.getElementById('timerStatus').className='status running';if(!timerInterval){timerInterval=setInterval(function(){currentTimerSeconds++;document.getElementById('timerDisplay').textContent=formatTimerTime(currentTimerSeconds);},1000);} } });}
function startTimer(){if(!isTimerRunning){isTimerRunning=true;document.getElementById('timerStatus').textContent='Timer uruchomiony';document.getElementById('timerStatus').className='status running';timerInterval=setInterval(function(){currentTimerSeconds++;document.getElementById('timerDisplay').textContent=formatTimerTime(currentTimerSeconds);},1000);}}
function stopTimer(){if(isTimerRunning){isTimerRunning=false;clearInterval(timerInterval);timerInterval=null;document.getElementById('timerStatus').textContent='Timer zatrzymany';document.getElementById('timerStatus').className='status stopped';}}
function resetTimer(){stopTimer();currentTimerSeconds=0;document.getElementById('timerDisplay').textContent=formatTimerTime(0);}
function addTimerToSpent(){if(currentTimerSeconds>0){var timerMinutes=Math.ceil(currentTimerSeconds/60);loadTimeData().then(function(d){d.spentMinutes+=timerMinutes;saveTimeData(d).then(function(){updateDisplay();resetTimer();askForNote(t,'').then(function(note){pushHistoryEntry('timer-add',timerMinutes,note);});});});}}
document.addEventListener('DOMContentLoaded',function(){
document.getElementById('btnPlanned').onclick=function(){var h=parseInt(document.getElementById('plannedHours').value)||0;var m=parseInt(document.getElementById('plannedMinutes').value)||0;var total=h*60+m;loadTimeData().then(function(d){d.plannedMinutes=total;saveTimeData(d).then(function(){updateDisplay();askForNote(t,'').then(function(note){pushHistoryEntry('plan',total,note);});});});};
document.getElementById('btnSpent').onclick=function(){var h=parseInt(document.getElementById('spentHours').value)||0;var m=parseInt(document.getElementById('spentMinutes').value)||0;var total=h*60+m;loadTimeData().then(function(d){d.spentMinutes=total;saveTimeData(d).then(function(){updateDisplay();askForNote(t,'').then(function(note){pushHistoryEntry('spent-set',total,note);});});});};
document.getElementById('btnStart').onclick=startTimer;document.getElementById('btnStop').onclick=stopTimer;document.getElementById('btnReset').onclick=resetTimer;document.getElementById('btnSave').onclick=addTimerToSpent;
updateDisplay();t.render(function(){return t.sizeTo(document.body);});});</script></body></html>
